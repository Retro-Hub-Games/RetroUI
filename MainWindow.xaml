<Window x:Class="RetroUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RetroUI"
        mc:Ignorable="d"
        Title="Retro Hub"
        WindowStyle="None" 
        WindowState="Maximized"
        ResizeMode="NoResize"
        AllowsTransparency="True" 
        Background="Transparent">

    <Window.Resources>
        <!-- Animations -->
        <Storyboard x:Key="CardHover">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                             To="1.05" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <PowerEase Power="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                             To="1.05" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <PowerEase Power="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="CardUnhover">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                             To="1" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <PowerEase Power="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                             To="1" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <PowerEase Power="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="PlayingAnimation" RepeatBehavior="Forever">
            <DoubleAnimation 
                Storyboard.TargetName="PlayIconScale"
                Storyboard.TargetProperty="ScaleX"
                From="1" To="0.8" Duration="0:0:1"
                AutoReverse="True"/>
            <DoubleAnimation 
                Storyboard.TargetName="PlayIconScale"
                Storyboard.TargetProperty="ScaleY"
                From="1" To="0.8" Duration="0:0:1"
                AutoReverse="True"/>
        </Storyboard>

        <!-- ScrollViewer Style -->
        <Style x:Key="InvisibleScrollViewer" TargetType="{x:Type ScrollViewer}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollViewer}">
                        <Grid>
                            <ScrollContentPresenter />
                            <ScrollBar x:Name="PART_HorizontalScrollBar"
                                     Orientation="Horizontal"
                                     Value="{TemplateBinding HorizontalOffset}"
                                     Maximum="{TemplateBinding ScrollableWidth}"
                                     ViewportSize="{TemplateBinding ViewportWidth}"
                                     Visibility="Hidden"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Converter -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <!-- Main content -->
        <Frame x:Name="MainFrame" NavigationUIVisibility="Hidden"/>
        <Grid x:Name="MainContent">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#FF1A1A1A" Offset="0"/>
                    <GradientStop Color="#FF0D0D0D" Offset="1"/>
                </LinearGradientBrush>
            </Grid.Background>

            <Grid.RowDefinitions>
                <RowDefinition Height="100"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Modern Header -->
            <Border Background="#FF161616" 
                    Effect="{StaticResource MaterialShadow}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Image Source="pack://application:,,,/Images/retrohub-logo.png"
                           Height="400" 
                           Margin="20,-150,0,0"
                           VerticalAlignment="Top"
                           HorizontalAlignment="Left"
                           Panel.ZIndex="1"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                </Grid>
            </Border>

            <!-- Modern Search Box -->
            <Border x:Name="SearchBorder" 
                    Grid.Row="1" 
                    Background="#FF222222"
                    Margin="20,10"
                    Height="50"
                    CornerRadius="25"
                    Visibility="Collapsed"
                    Effect="{StaticResource MaterialShadow}">
                <Grid Margin="20,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Path Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                          Fill="#FF4081" 
                          Stretch="Uniform" 
                          Width="20" 
                          Height="20"/>
                    <TextBox x:Name="SearchBox"
                             Grid.Column="1"
                             Margin="10,0,0,0"
                             Background="Transparent"
                             Foreground="White"
                             FontSize="16"
                             BorderThickness="0"
                             VerticalAlignment="Center"
                             TextChanged="SearchBox_TextChanged"/>
                </Grid>
            </Border>

            <!-- App Cards -->
            <ScrollViewer Grid.Row="2" 
                          Style="{StaticResource InvisibleScrollViewer}"
                          HorizontalScrollBarVisibility="Hidden" 
                          VerticalScrollBarVisibility="Disabled"
                          Margin="20,10,20,20" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <!-- Now Playing Card -->
                    <Border x:Name="NowPlayingCard" 
                            Margin="10" 
                            Background="#FF222222" 
                            CornerRadius="15" 
                            Width="400" 
                            Height="500"
                            Effect="{StaticResource MaterialShadow}"
                            Visibility="{Binding ShowNowPlaying, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Now Playing Header -->
                            <Border Background="#FF4081" 
                                    CornerRadius="15,15,0,0">
                                <Grid Margin="15,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Animated Playing Icon -->
                                    <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"
                                          Fill="White" 
                                          Width="24" 
                                          Height="24"
                                          Margin="0,0,10,0">
                                        <Path.RenderTransform>
                                            <ScaleTransform x:Name="PlayIconScale" ScaleX="1" ScaleY="1"/>
                                        </Path.RenderTransform>
                                    </Path>

                                    <TextBlock Grid.Column="1"
                                              Text="NOW PLAYING" 
                                              Foreground="White" 
                                              FontSize="20" 
                                              FontWeight="Bold" 
                                              VerticalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <!-- Game Box Art -->
                            <Border Grid.Row="1" 
                                    Margin="20"
                                    CornerRadius="10"
                                    ClipToBounds="True">
                                <Grid>
                                    <!-- Background Banner (blurred) -->
                                    <Image Source="{Binding NowPlaying.Banner, TargetNullValue='pack://application:,,,/Assets/Images/default-banner.png'}" 
                                           Stretch="UniformToFill"
                                           Width="360"
                                           Height="320">
                                        <Image.Effect>
                                            <BlurEffect Radius="20"/>
                                        </Image.Effect>
                                    </Image>

                                    <!-- Main Box Art -->
                                    <Image Source="{Binding NowPlaying.Banner, TargetNullValue='Images/default-banner.png'}" 
                                           Width="280"
                                           Height="280"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <!-- Game Info -->
                            <Border Grid.Row="2" 
                                    Background="#FF2A2A2A" 
                                    CornerRadius="0,0,15,15">
                                <Grid Margin="20">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Text="{Binding NowPlaying.Name}" 
                                              Foreground="White" 
                                              TextAlignment="Left"
                                              TextWrapping="Wrap"
                                              FontSize="22"
                                              FontWeight="SemiBold"/>

                                    <TextBlock Grid.Row="1"
                                              Text="{Binding NowPlaying.PlayTime, StringFormat='Play time: {0}'}" 
                                              Foreground="#FFB0B0B0"
                                              TextAlignment="Left"
                                              Margin="0,5,0,0"
                                              FontSize="14"/>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Existing ItemsControl -->
                    <ItemsControl x:Name="AppsList" ItemsSource="{Binding InstalledApps}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" IsItemsHost="True"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="AppCardBorder" 
                                        Margin="10" 
                                        Background="#FF222222" 
                                        CornerRadius="15" 
                                        MouseDown="AppCard_MouseDown"
                                        Width="300" 
                                        Height="400"
                                        Effect="{StaticResource MaterialShadow}">
                                    <Border.RenderTransform>
                                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                                    </Border.RenderTransform>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Game Box Art Container -->
                                        <Border CornerRadius="15,15,0,0" 
                                                ClipToBounds="True">
                                            <Image Source="{Binding BoxArt}" 
                                                   Stretch="UniformToFill"
                                                   Width="300"
                                                   Height="300"
                                                   RenderOptions.BitmapScalingMode="HighQuality"
                                                   SnapsToDevicePixels="True"
                                                   UseLayoutRounding="True"/>
                                        </Border>

                                        <!-- Game Info Panel -->
                                        <Border Grid.Row="1" 
                                                        Background="#FF2A2A2A" 
                                                        CornerRadius="0,0,15,15">
                                            <Grid Margin="15">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <TextBlock Text="{Binding Name}" 
                                                                 Foreground="White" 
                                                                 TextAlignment="Left"
                                                                 TextWrapping="Wrap"
                                                                 FontSize="18"
                                                                 FontWeight="SemiBold"/>

                                                <TextBlock Grid.Row="1"
                                                                 Text="{Binding LastPlayed, StringFormat='Last played: {0}'}" 
                                                                 Foreground="#FFB0B0B0"
                                                                 TextAlignment="Left"
                                                                 Margin="0,5,0,0"
                                                                 FontSize="12"/>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Border>

                                <DataTemplate.Triggers>
                                    <EventTrigger RoutedEvent="MouseEnter">
                                        <BeginStoryboard Storyboard="{StaticResource CardHover}"/>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="MouseLeave">
                                        <BeginStoryboard Storyboard="{StaticResource CardUnhover}"/>
                                    </EventTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

            <!-- Bottom Navigation Bar -->
            <Border Grid.Row="2" 
                            VerticalAlignment="Bottom" 
                            Background="#FF161616"
                            Height="80"
                            Effect="{StaticResource MaterialShadow}">
                <StackPanel Orientation="Horizontal" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center"
                                    Margin="20">
                    <!-- Store Icon -->
                    <Button Style="{StaticResource NavButtonStyle}"
                                    Click="Store_Click">
                        <Path Data="M19 7V4H5v3H2v13h20V7h-3zm-2-2v2h-2V5h2zm-4 0v2h-2V5h2zm-4 0v2H7V5h2zM5 5h2v2H5V5z" 
                                      Fill="White" 
                                      Width="24" 
                                      Height="24"/>
                    </Button>

                    <!-- Settings Icon -->
                    <Button Style="{StaticResource NavButtonStyle}"
                                    Margin="40,0"
                                    Click="Settings_Click">
                        <Path Data="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"
                                          Fill="White" 
                                          Width="24" 
                                          Height="24"/>
                    </Button>

                    <!-- Power Icon -->
                    <Button x:Name="PowerButton"
                                    Style="{StaticResource NavButtonStyle}"
                                    Click="Power_Click">
                        <Path Data="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"
                                      Fill="White" 
                                      Width="24" 
                                      Height="24"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Replace the existing Popup with this fullscreen power menu -->
            <Grid x:Name="PowerMenuOverlay" 
                          Visibility="Collapsed" 
                          Grid.RowSpan="3" 
                          Background="#80000000">
                <Border Width="400" 
                                Height="Auto"
                                Background="#FF222222" 
                                CornerRadius="20" 
                                Effect="{StaticResource MaterialShadow}"
                                VerticalAlignment="Center">
                    <StackPanel Margin="20">
                        <TextBlock Text="Power Options" 
                                          Foreground="White" 
                                          FontSize="24" 
                                          FontWeight="Bold" 
                                          HorizontalAlignment="Center"
                                          Margin="0,0,0,20"/>

                        <Button Style="{StaticResource PowerMenuButtonStyle}" 
                                        Click="Shutdown_Click"
                                        Width="300"
                                        Height="60"
                                        Margin="0,10">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"
                                              Fill="White" 
                                              Width="24" 
                                              Height="24"/>
                                <TextBlock Text="Shutdown" 
                                                 Foreground="White" 
                                                 Margin="15,0,0,0"
                                                 FontSize="18"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource PowerMenuButtonStyle}" 
                                        Click="Restart_Click"
                                        Width="300"
                                        Height="60"
                                        Margin="0,10">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                                              Fill="White" 
                                              Width="24" 
                                              Height="24"/>
                                <TextBlock Text="Restart" 
                                                 Foreground="White" 
                                                 Margin="15,0,0,0"
                                                 FontSize="18"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource PowerMenuButtonStyle}" 
                                        Click="CancelPowerMenu_Click"
                                        Width="300"
                                        Height="60"
                                        Margin="0,10">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                              Fill="White" 
                                              Width="24" 
                                              Height="24"/>
                                <TextBlock Text="Cancel" 
                                                 Foreground="White" 
                                                 Margin="15,0,0,0"
                                                 FontSize="18"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Input Blocking Overlay -->
        <Grid x:Name="InputBlockOverlay" 
              Background="#80000000" 
              Visibility="{Binding IsGameRunning, Converter={StaticResource BooleanToVisibilityConverter}}" 
              IsHitTestVisible="True">
            <TextBlock Text="Game is running..." 
                       Foreground="White" 
                       FontSize="24" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Window>

